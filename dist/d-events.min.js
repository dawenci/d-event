/*!
 * d-events.js v1.0.0
 * (c) 2018 dawenci. */

!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.DEvents=n()}(this,function(){"use strict";var n,_=Object.prototype.hasOwnProperty,c=(n=0,function(t){return(t||"")+n++});var l;function r(r,o){for(var s=[],t=2;t<arguments.length;t++)s[t-2]=arguments[t];if("function"!=typeof r)throw new TypeError("Bind must be called on a function");return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var e=s.length,i=0;i<e;i+=1)null!==s[i]&&(t[i]=s[i]);return r.call.apply(r,[o].concat(t))}}function o(t,n,e,i){if(!e)return t;var r=t[n]=function(e){if("function"!=typeof e)throw new TypeError("Expected a function");var i,r=!1;return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r?i:(r=!0,i=e.apply(void 0,t))}}(function(){i(n,r),e.apply(this,arguments)});return r._callback=e,t}function f(t,n,e,i,r){var o,s=/\s+/,_=0;if(e&&"object"==typeof e){void 0!==i&&"context"in r&&void 0===r.context&&(r.context=i);for(o=Object.keys(e);_<o.length;_++)n=f(t,n,o[_],e[o[_]],r)}else if(e&&s.test(e))for(o=e.split(s);_<o.length;_++)n=t(n,o[_],i,r);else n=t(n,e,i,r);return n}function i(t,n,e,i){if(e){var r=t[n]||(t[n]=[]),o=i.context,s=o||i.ctx,_=i.listening;_&&(_.count+=1),r.push({callback:e,context:o,ctx:s,listening:_})}return t}function s(t,n,e,i){if(t){var r,o=i.context,s=i.listeners,_=0;if(n||o||e){for(r=n?[n]:Object.keys(t);_<r.length;_++){var c=t[n=r[_]];if(!c)break;for(var l=[],f=0;f<c.length;f++){var u=c[f];if(e&&e!==u.callback&&e!==u.callback._callback||o&&o!==u.context)l.push(u);else{var a=u.listening;a&&a.off(n,e)}}l.length?t[n]=l:delete t[n]}return t}for(r=Object.keys(s);_<r.length;_++)s[r[_]].cleanup()}}function u(t,n,e,i){if(t){var r=t[n],o=t.all;r&&o&&(o=o.slice()),r&&a(r,i),o&&a(o,[n].concat(i))}return t}function a(t,n){var e,i=t.length,r=n[0],o=n[1],s=n[2],_=-1;switch(n.length){case 0:for(;++_<i;)(e=t[_]).callback.call(e.ctx);return;case 1:for(;++_<i;)(e=t[_]).callback.call(e.ctx,r);return;case 2:for(;++_<i;)(e=t[_]).callback.call(e.ctx,r,o);return;case 3:for(;++_<i;)(e=t[_]).callback.call(e.ctx,r,o,s);return;default:for(;++_<i;)(e=t[_]).callback.apply(e.ctx,n);return}}var t=function(){function t(){}return t.prototype.on=function(t,n,e){(this.__events__=f(i,this.__events__||{},t,n,{context:e,ctx:this,listening:l}),l)&&(((this.__listeners__||(this.__listeners__={}))[l.id]=l).interop=!1);return this},t.prototype.off=function(t,n,e){return this.__events__&&(this.__events__=f(s,this.__events__,t,n,{context:e,listeners:this.__listeners__})),this},t.prototype.trigger=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];return this.__events__&&f(u,this.__events__,t,void 0,n),this},t.prototype.listenTo=function(t,n,e){if(!t)return this;var i,r=t.__listenId__||(t.__listenId__=c("l")),o=this.__listeningTo__||(this.__listeningTo__={}),s=l=o[r];s||(this.__listenId__||(this.__listenId__=c("l")),s=l=o[r]=new h(this,t));try{t.on(n,e,this)}catch(t){i=t}if(l=void 0,i)throw i;return s.interop&&s.on(n,e),this},t.prototype.stopListening=function(t,n,e){var i=this.__listeningTo__;if(!i)return this;for(var r=t?[t.__listenId__]:Object.keys(i),o=0;o<r.length;o++){var s=i[r[o]];if(!s)break;s.target.off(n,e,this),s.interop&&s.off(n,e)}return function(t){if(null==t)return!0;for(var n in t)if(_.call(t,n))return!1;return!0}(i)&&(this.__listeningTo__=void 0),this},t.prototype.once=function(t,n,e){var i=f(o,{},t,n,r(this.off,this));return"string"==typeof t&&null==e&&(n=void 0),this.on(i,n,e)},t.prototype.listenToOnce=function(t,n,e){var i=f(o,{},n,e,r(this.stopListening,this,t));return this.listenTo(t,i)},t}(),h=function(){function t(t,n){this.listener=t,this.target=n,this.__events__=void 0,this.interop=!0,this.count=0,this.listener=t,this.target=n,this.id=t.__listenId__}return t.prototype.off=function(t,n){var e;this.interop?(this.__events__=f(s,this.__events__,t,n,{context:void 0,listeners:void 0}),e=!this.__events__):(this.count--,e=0===this.count),e&&this.cleanup()},t.prototype.cleanup=function(){delete this.listener.__listeningTo__[this.target.__listenId__],this.interop||delete this.target.__listeners__[this.id]},t}();return h.prototype.on=t.prototype.on,t});